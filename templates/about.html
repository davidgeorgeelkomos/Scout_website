{% extends "layout.html" %}

{% block title %}
Join Us
{% endblock %}

{% block main %}

<!-- Hero -->
<header class="hero d-flex align-items-center justify-content-center text-center text-white">
  <h1>About Us</h1>
</header>

<!-- About Section -->
<section class="container my-5">
  <h2 class="text-center mb-4">من نحن</h2>
  <p class="lead text-center">
    مجموعات العذراء الكشفية ليست مجرد نشاط أو لقاء أسبوعي، لكنها خدمة كنسية حقيقية
    تجمع بين البُعد الروحي والبعد الكشفي. هدفنا إننا نقرّب البعيد ونثبّت القريب،
    ونخلق بيئة تنمّي الإنسان روحيًا وإنسانيًا وكشفيًا.
  </p>
</section>

<!-- Join Us Section -->
<section class="container my-5">
  <h2 class="text-center mb-4">Join Us</h2>
  <p class="text-center">املأ البيانات للانضمام إلى مجموعات الكشافة.</p>

  <form action="/register" method="POST">

    <!-- Full Name -->
    <div class="mb-3">
      <label class="form-label">Full Name</label>
      <input type="text" class="form-control" name="username" required>
    </div>

    <!-- Password -->
    <div class="mb-3">
      <label class="form-label">Password</label>
      <input type="password" class="form-control" name="password" required>
    </div>

    <!-- Confirm Password -->
    <div class="mb-3">
      <label class="form-label">Confirm Password</label>
      <input type="password" class="form-control" name="confirmation" required>
    </div>

    <!-- Birthday -->
    <div class="mb-3">
      <label class="form-label">Birthday</label>
      <input type="date" class="form-control" name="birthday" required>
    </div>

    <!-- Phone -->
    <div class="mb-3">
      <label class="form-label">Phone Number</label>
      <input type="text"
             class="form-control"
             name="phone"
             placeholder="+20**********"
             pattern="\+20[0-9]{10}"
             value="+20"
             onkeydown="if(event.key !== 'Backspace' && !this.value.startsWith('+20')) this.value='+20';"
             required>
    </div>

    <!-- Sector -->
    <div class="mb-3">
      <label class="form-label">Sector</label>
      <select class="form-select" name="sector" required>
        <option disabled selected>Select sector</option>
        <option value="أشبال وزهرات">أشبال وزهرات</option>
        <option value="مبتداء ومرشدات">مبتداء ومرشدات</option>
        <option value="متقدم">متقدم</option>
        <option value="جوالة">جوالة</option>
      </select>
    </div>

    <!-- Map -->
    <div class="mb-3">
      <label class="form-label">Home Location (Click on the map)</label>
      <div id="map" style="height: 300px; border-radius: 8px;"></div>
    </div>

    <input type="hidden" name="lat" id="lat">
    <input type="hidden" name="lng" id="lng">

    <button class="btn btn-primary w-100 mt-3">Join Now</button>
  </form>
</section>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  const map = L.map('map').setView([26.8206, 30.8025], 6);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  let marker;

  // Auto detect location
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      function (pos) {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;

        map.setView([lat, lng], 16);

        marker = L.marker([lat, lng]).addTo(map);

        document.getElementById("lat").value = lat;
        document.getElementById("lng").value = lng;
      }
    );
  }

  // User clicks to change location
  map.on("click", function (e) {
    if (marker) {
      marker.setLatLng(e.latlng);
    } else {
      marker = L.marker(e.latlng).addTo(map);
    }

    document.getElementById("lat").value = e.latlng.lat;
    document.getElementById("lng").value = e.latlng.lng;
  });
</script>

{% endblock %}
